<!DOCTYPE html>
<html>
<head>
	<title>Laravel Events</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="../reveal/css/reveal.css">
	<link rel="stylesheet" href="../reveal/css/theme/night.css" id="theme">
	<link rel="stylesheet" href="../reveal/lib/css/monokai_sublime.css">
</head>
<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h1>Laravel Events</h1>
				<p>
					Jenny 2015/11/23
				</p>
			</section>
			<section>
				<h2>小觀念</h2>
				<ul>
					<li>
						程式放哪兒？
						<ul>
							<li>Event：app/Events</li>
							<li>Listeners：app/Listeners</li>
						</ul>
					</li>
					<li>什麼是 Event？</li>
					<li>什麼是 Listeners？</li>
					<li>要做什麼的事情的程式應該放在 Listener，Event 裡面不應該有任何做事情的程式</li>
				</ul>
			</section>
			<section>
				<section>
					<h2>設定 → 建立 → 觸發</h2>
					<p>
						不合理狀況劇 1：<br>
						新聞建立後要跟世界說哈囉
					</p>
					<p>
						小問題：<br>
						<span class="fragment">誰是 Event？</span><span class="fragment">(新聞建立)</span><br>
						<span class="fragment">誰是 Listeners？</span><span class="fragment">(跟世界說哈囉)</span>
					</p>
				</section>
				<section>
					<h2>設定</h2>
				</section>
				<section>
					<h2>註冊事件和監聽器</h2>
					<p>
						app/Providers/EventServiceProvider.php
						<pre><code class="php" data-trim>
'App\Events\NewsAddComplate' => [
	'App\Listeners\SayHello',
],
						</code></pre>
					</p>
				</section>
				<section>
					<h2>建立</h2>
				</section>
				<section>
					<h2>產生 Class</h2>
					<pre><code data-trim>
php artisan event:generate
					</code></pre>
					<img src="img/event_generate.jpg">
				</section>
				<section>
					<h2>撰寫程式</h2>
					<pre><code class="php" data-trim>
public function handle(NewsAddComplate $event)
{
    // 事件邏輯程式都放這裡
    echo 'Hello World';

    // 如果你什麼都不想做
    // return false;
}
				</code></pre>
				</section>
				<section>
					<h2>觸發</h2>
					<pre><code class="php" data-trim>
Event::fire(new NewsAddComplate());
					</code></pre>
				</section>
				<section>
					<h2>補充</h2>
					<p>我們也可以手動建立事件</p>
					<pre><code class="php" data-trim>
public function boot(DispatcherContract $events)
{
    parent::boot($events);

    $events->listen('manually_event', function ($arguments) {
        echo 'Hello World';
    });
}
					</code></pre>
					<pre><code class="php" data-trim>
Event::fire('manually_event', array($arguments));
					</code></pre>
				</section>
			</section>
			<section>
				<section>
					<h2>變數傳遞、觸發多個 Listener</h2>
					<p>
						不合理狀況劇 2：<br>
						新聞建立後<br>
						除了要說哈囉<br>
						還要印出建立的新聞 Data
					</p>
				</section>
				<section>
					<p>app\Events\NewsAddComplate.php</p>
					<pre><code class="php" data-trim>
public $news;

/**
 * Create a new event instance.
 *
 * @return void
 */
public function __construct(News $news)
{
    $this->news = $news;
}
					</code></pre>
				</section>
				<section>
					<p>app\Listeners\PrintNews.php</p>
					<pre><code class="php" data-trim>
public function handle(NewsAddComplate $event)
{
    dd($event->news);
}
					</code></pre>
				</section>
			</section>
			<section>
				<h2>Queued Event Listeners</h2>
				<p>
					參考 queue 教學，新增 ShouldQueue interface 到你的 class 中
				</p>
				<blockquote style="text-align:left;width:100%;">
作業：<br>
把不合理狀況劇改成「當我的新聞建立時，假裝發 mail 出來」<br>
※ 請把「假裝發 mail」這件事情加入 queue 裡
				</blockquote>
			</section>
			<section>
				<h2>Broadcasting Events</h2>
				<p>要用到排程，暫時不講</p>
			</section>
			<section>
				<h2>Event Subscribers</h2>
				<p>看官網，投影片來不及做</p>
			</section>
			<section>
				<section>
					<h2>Framework Events</h2>
					<p>有很多，我只列 "2" 個</p>
					<table>
					<thead>
						<tr>
							<th>Event</th>
							<th>Parameter(s)</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>auth.login</td>
							<td>$user, $remember</td>
						</tr>
						<tr>
							<td>auth.logout</td>
							<td>$user</td>
						</tr>
						</tbody>
					</table>
				</section>
				<section>
					<h2>如何使用</h2>
					<pre><code class="php" data-trim>
'auth.login' => [
    'App\Listeners\SayHello',
],
					</code></pre>
					<pre><code class="php" data-trim>
 public function handle()
{
    echo 'Hello World';
    exit;	// 記得要有，要不然看不到
}
					</code></pre>
				</section>
			</section>
			<section>
				<h2>參考資料</h2>
				<ul>
					<li>
						<a href="http://laravel.com/docs/5.1/events" target="_blank">Laravel 教學：Events</a>
					</li>
				</ul>
			</section>
		</div>
	</div>

	<script type="text/javascript" src="../reveal/lib/js/head.min.js"></script>
	<script type="text/javascript" src="../reveal/js/reveal.js"></script>
	<script>
		Reveal.initialize({
			controls: true,
			progress: true,
			history: true,
			center: true,

			transition: 'slide', // none/fade/slide/convex/concave/zoom

			// Optional reveal.js plugins
			dependencies: [
				{ src: '../reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },
				{ src: '../reveal/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: '../reveal/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: '../reveal/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
				{ src: '../reveal/plugin/zoom-js/zoom.js', async: true },
				{ src: '../reveal/plugin/notes/notes.js', async: true }
			]
		});
	</script>
</body>
</html>